var SimpleLocatorAdmin;(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).Modals=function(){var e=this,t=jQuery;return e.activeBtn="",e.activeModal="",e.modalOpen=!1,e.selectors={toggleBtn:"[data-modal-toggle]",backdrop:"[data-modal-backdrop]",closeBtn:"[data-modal-close]"},e.bindEvents=function(){t(document).on("click",e.selectors.toggleBtn,function(o){o.preventDefault(),e.activeBtn=t(this),e.openModal()}),t(document).on("click",e.selectors.closeBtn,function(t){t.preventDefault(),e.closeModals()}),t(document).on("open-modal-manual",function(o,a){e.activeModal=t('*[data-modal="'+a+'"]'),e.openModal()}),t(document).on("close-modal-manual",function(t){e.closeModals()}),t(document).on("click",e.selectors.backdrop,function(t){e.closeModals()})},e.openModal=function(){if(e.modalOpen)e.closeModals();else{if(t(e.activeBtn).length>0){var o=t(e.activeBtn).attr("data-modal-toggle");e.activeModal=t('*[data-modal="'+o+'"]')}t(e.activeModal).addClass("active"),e.modalOpen=!0,t(document).trigger("open-modal",[e.activeBtn,e.activeModal])}},e.closeModals=function(){e.modalOpen=!1,t("[data-modal]").removeClass("active"),t(document).trigger("close-modal",[e.activeBtn,e.activeModal])},e.bindEvents()},(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).PostEdit=function(){var e=this,t=jQuery;return e.lookupaddress=!0,e.mappinrelocated=!1,e.selectors={inputAddress:"#wpsl_address",inputCity:"#wpsl_city",inputState:"#wpsl_state",inputZip:"#wpsl_zip",inputLatitude:"#wpsl_latitude",inputLongitude:"#wpsl_longitude",noAddressConfirm:"data-simple-locator-confirm-no-address",publishButton:"#publish"},e.bindEvents=function(){t(window).on("load",function(){e.setMapPinStatus(),e.checkMapStatus(),"true"===t("#wpsl_custom_geo").val()&&(mappinrelocated=!0)}),t(document).on("click",".acf-tab-button",function(){e.checkMapStatus()}),t(document).on("click",e.selectors.publishButton,function(o){if(("wpsl_latitude"===wpsl_locator.lat_field||""===wpsl_locator.map_field)&&e.lookupaddress&&!e.mappinrelocated)if(o.preventDefault(),editScreenGoogleApiError)t(document).trigger("open-modal-manual",["post-edit-error"]);else{var a=e.formatAddress();e.googleGeocodeAddress(a)}}),t(document).on("click","["+e.selectors.noAddressConfirm+"]",function(t){t.preventDefault(),e.saveWithoutLocation()})},e.setMapPinStatus=function(){e.mappinrelocated=!!t("#wpsl_custom_geo").val("true")},e.formatAddress=function(){return t(e.selectors.inputAddress).val()+" "+t(e.selectors.inputCity).val()+" "+t(e.selectors.inputState).val()+" "+t(e.selectors.inputZip).val()},e.googleGeocodeAddress=function(o){geocoder=new google.maps.Geocoder,geocoder.geocode({address:o},function(o,a){if(a==google.maps.GeocoderStatus.OK){var n=o[0].geometry.location.lat(),l=o[0].geometry.location.lng();t(e.selectors.inputLatitude).val(n),t(e.selectors.inputLongitude).val(l),e.lookupaddress=!1,t(e.selectors.publishButton).click()}else t(document).trigger("open-modal-manual",["post-edit-error"])})},e.saveWithoutLocation=function(){t(document).trigger("close-modal-manual"),e.lookupaddress=!1,t(e.selectors.publishButton).click()},e.checkMapStatus=function(){if(t("#wpslmap").length>0){var o=t(e.selectors.inputLatitude).val(),a=t(e.selectors.inputLongitude).val();""!==o&&""!==a&&(t("#wpslmap").show(),e.loadGoogleMap(o,a))}},e.loadGoogleMap=function(o,a){var n,l=new google.maps.Map(document.getElementById("wpslmap"),{zoom:14,center:new google.maps.LatLng(o,a),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,scaleControl:!1});n=new google.maps.Marker({position:new google.maps.LatLng(o,a),map:l,draggable:!0}),google.maps.event.addListener(n,"drag",function(){t(e.selectors.inputLatitude).val(n.position.lat()),t(e.selectors.inputLongitude).val(n.position.lng()),t(e.selectors.inputLatitude+","+e.selectors.inputLongitude).attr("readonly",!1),t("#wpsl_custom_geo").val("true"),mappinrelocated=!0})},e.bindEvents()},(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).DefaultMap=function(){var e=this,t=jQuery;return e.selectors={showDefaultCheckbox:"data-simple-locator-default-checkbox",defaultMap:"data-simple-locator-default-map",zoomInput:"data-simple-locator-zoom-input",latitudeInput:"data-simple-locator-latitude-input",longitudeInput:"data-simple-locator-longitude-input",locationSearchButton:"data-simple-locator-location-search-button",locationSearchInput:"data-simple-locator-location-search-input",error:"data-simple-locator-error"},e.bindEvents=function(){t(document).ready(function(){t("["+e.selectors.defaultMap+"]").length<1||wpsl_locator_defaultmap.enabled&&e.toggleDefaultMap(!0)}),t(document).on("change","["+e.selectors.showDefaultCheckbox+"]",function(){t(this).is(":checked")?e.toggleDefaultMap(!0):e.toggleDefaultMap(!1)}),t(document).on("click","["+e.selectors.locationSearchButton+"]",function(t){t.preventDefault(),e.findLocation()})},e.toggleDefaultMap=function(o){if(o)return t("["+e.selectors.defaultMap+"]").show(),void e.loadDefaultMap();t("["+e.selectors.defaultMap+"]").hide()},e.loadDefaultMap=function(o,a){o||(o=wpsl_locator_defaultmap.latitude),a||(a=wpsl_locator_defaultmap.longitude);var n=new google.maps.LatLng(o,a),l={center:n,zoom:parseInt(wpsl_locator_defaultmap.zoom),mapTypeControl:!1,streetViewControl:!1,styles:wpsl_locator_defaultmap.styles},s=new google.maps.Map(document.getElementById("wpsl-default"),l),i=new google.maps.Marker({position:n,map:s,icon:wpsl_locator_defaultmap.mappin,draggable:!0});google.maps.event.addListener(s,"zoom_changed",function(){var o=s.getZoom();t("["+e.selectors.zoomInput+"]").val(o)}),google.maps.event.addListener(i,"drag",function(){t("["+e.selectors.latitudeInput+"]").val(i.position.lat()),t("["+e.selectors.longitudeInput+"]").val(i.position.lng())})},e.findLocation=function(){e.toggleError(!1);var o=t("["+e.selectors.locationSearchInput+"]").val();geocoder=new google.maps.Geocoder,geocoder.geocode({address:o},function(t,o){if(o!=google.maps.GeocoderStatus.OK)e.toggleError(!0);else{var a=t[0].geometry.location.lat(),n=t[0].geometry.location.lng();e.loadDefaultMap(a,n)}})},e.loadSearchResults=function(o,a){e.loadDefaultMap(o,a),t("["+e.selectors.latitudeInput+"]").val(o),t("["+e.selectors.longitudeInput+"]").val(a)},e.toggleError=function(o){o?t("["+e.selectors.error+"]").show():t("["+e.selectors.error+"]").hide()},e.bindEvents()},(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).ResultsDisplay=function(){var e=this,t=jQuery;return e.bindEvents=function(){t(document).ready(function(){e.enableDatePicker()}),t(document).on("click",".wpsl-field-add",function(t){t.preventDefault(),e.addResultField()}),t(document).on("click",".wpsl-post-field-add",function(t){t.preventDefault(),e.addPostField()})},e.addResultField=function(){var e="["+t("#wpsl-fields").val()+"]";tinymce.activeEditor.execCommand("mceInsertContent",!1,e)},e.addPostField=function(){var e="["+t("#wpsl-post-fields").val()+"]";tinymce.activeEditor.execCommand("mceInsertContent",!1,e)},e.enableDatePicker=function(){t("[data-date-picker]").datepicker({beforeShow:function(e,o){t("#ui-datepicker-div").addClass("wpsl-datepicker")}})},e.bindEvents()},(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).MapDisplay=function(){var e=this,t=jQuery;return e.selectors={styleChoiceSelect:"data-simple-locator-map-style-choice",styleChoice:"data-simple-locator-map-style",styleList:"data-simple-locator-map-style-list",styleSelect:"data-simple-locator-map-style-select",styleChoiceInput:"data-simple-locator-map-style-choice-input",customOptionsCheckbox:"data-simple-locator-custom-map-options-checkbox",customOptions:"data-simple-locator-custom-map-options"},e.bindEvents=function(){t(document).ready(function(){t("["+e.selectors.styleList+"]").length<1||e.buildMapChoices()}),t(document).on("change","["+e.selectors.styleChoiceSelect+"]",function(){var o=t(this).val();e.toggleChoice(o)}),t(document).on("click","["+e.selectors.styleSelect+"]",function(o){o.preventDefault(),e.selectStyle(t(this))}),t(document).on("change","["+e.selectors.customOptionsCheckbox+"]",function(){t(this).is(":checked")?t("["+e.selectors.customOptions+"]").show():t("["+e.selectors.customOptions+"]").hide()})},e.toggleChoice=function(o){o=t("["+e.selectors.styleChoice+"="+o+"]");t("["+e.selectors.styleChoice+"]").hide(),t(o).show()},e.buildMapChoices=function(){t("["+e.selectors.styleList+"]").empty(),t.each(wpsl_locator_mapstyles,function(t,o){e.buildMapHtml(t,o),e.loadChoiceMap(o)})},e.buildMapHtml=function(o,a){var n='<li class="';o%3==0&&(n+="first"),a.selected&&(n+=" active"),n+='">',n+="<h4>"+a.title+"</h4>",n+='<div class="map" id="map_'+a.id+'"></div>',n+='<a href="'+a.id+'" class="choose-style" '+e.selectors.styleSelect+">",n+="Use Style",n+="</a>",n+="</li>",t("["+e.selectors.styleList+"]").append(n)},e.loadChoiceMap=function(e){var t=JSON.parse(e.styles),o="map_"+e.id,a={center:new google.maps.LatLng(40.7699354,-73.9810812),zoom:13,mapTypeControl:!1,streetViewControl:!1,styles:t};e=new google.maps.Map(document.getElementById(o),a)},e.selectStyle=function(o){var a=t(o).attr("href");t("["+e.selectors.styleChoiceInput+"]").val(a),t("["+e.selectors.styleList+"] li").removeClass("active"),t(o).parent("li").addClass("active")},e.bindEvents()},(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).SearchHistory=function(){var e=this,t=jQuery;return e.locations,e.selectors={container:"data-simple-locator-search-history-map",perPage:"data-simple-locator-history-per-page"},e.bindEvents=function(){t(document).ready(function(){t("["+e.selectors.container+"]").length<1||(e.locations=search_history_locations,e.loadMap())}),t("["+e.selectors.perPage+"]").on("change",function(){t(this).parents("form").submit()})},e.loadMap=function(){var o,a=wpsl_locator_searchhistory.mapstyles,n=wpsl_locator_searchhistory.mappin?wpsl_locator_searchhistory.mappin:"",l=new google.maps.LatLngBounds,s=e.locations,i=t("["+e.selectors.container+"]"),c={mapTypeId:"roadmap",mapTypeControl:!1,zoom:8,styles:a,scrollwheel:!1,panControl:!1},r=new google.maps.InfoWindow,d=new google.maps.Map(i[0],c);for(o=0;o<s.length;o++){var p=new google.maps.LatLng(s[o].latitude,s[o].longitude);l.extend(p);var u=new google.maps.Marker({position:p,map:d,title:s[o].search_term,icon:n});s[o].infowindow="<h4>"+s[o].date+"</h4>",s[o].infowindow+="<p>",s[o].infowindow+=wpsl_locator_searchhistory.searchTerm+": "+s[o].search_term,s[o].infowindow+="<br>"+wpsl_locator_searchhistory.searchTermFormatted+": "+s[o].search_term_formatted,s[o].infowindow+="<br>"+wpsl_locator_searchhistory.userIp+": "+s[o].user_ip,s[o].infowindow+="<br>"+wpsl_locator_searchhistory.distance+": "+s[o].distance,s[o].infowindow+="</p>",google.maps.event.addListener(u,"click",function(e,t){return function(){r.setContent(s[t].infowindow),r.open(d,e)}}(u,o)),d.fitBounds(l);var m=google.maps.event.addListener(d,"idle",function(){s.length<2&&d.setZoom(13),google.maps.event.removeListener(m)})}var g=google.maps.event.addListener(d,"bounds_changed",function(e){google.maps.event.removeListener(g)})},e.bindEvents()},jQuery(document).ready(function(){new SimpleLocatorAdmin.Factory}),(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).endpoints={},SimpleLocatorAdmin.Factory=function(){jQuery;return this.init=function(){new SimpleLocatorAdmin.Modals,new SimpleLocatorAdmin.PostEdit,new SimpleLocatorAdmin.MapDisplay,new SimpleLocatorAdmin.ResultsDisplay,new SimpleLocatorAdmin.DefaultMap,new SimpleLocatorAdmin.SearchHistory},this.init()};var editScreenGoogleApiError=!1;function gm_authFailure(e){editScreenGoogleApiError=!0}